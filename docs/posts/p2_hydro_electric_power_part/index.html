<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jay Lowe">
<meta name="dcterms.date" content="2024-08-17">

<title>DAMS DAMS DAMS – Jay Lowe’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jay Lowe’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/jay-lowe-a21075163/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://twitter.com/ogjaylowe"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text">Twitter</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ogjaylowe"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Github</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DAMS DAMS DAMS</h1>
  <div class="quarto-categories">
    <div class="quarto-category">energy</div>
    <div class="quarto-category">ai</div>
    <div class="quarto-category">series</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jay Lowe </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 17, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="article-summary" class="level5">
<h5 class="anchored" data-anchor-id="article-summary">Article Summary</h5>
<blockquote class="blockquote">
<p>How hydroelectric dams produce energy and the way Idaho uses it to power the majority of its cities</p>
</blockquote>
</section>
<section id="dams-dams-dams-part-2" class="level1">
<h1><strong>DAMS DAMS DAMS [PART 2]</strong></h1>
<p>Now that energy sectors <a href="../../posts/p1_mapping_out_the_energy_space/index.html">have been broken down</a>, let’s start exploring energy sources.</p>
<p>Since the first human saw the first river, we’ve been doing everything we can to ruin them. Some might say it was a match made in heaven. In fact, <a href="https://www.notion.so/Energy-0214c4459b524289b881f243c02b890b?pvs=21">3000 BCE was the beginning of serious river fuckery</a>—but honestly we’ve probably been doing it for longer than that!</p>
<blockquote class="blockquote">
<p>Hydroelectric powerplants are the most efficient means of producing electric energy. The efficiency of today’s hydroelectric plant is about 90 percent</p>
</blockquote>
<ul>
<li>U.S. Bureau of Reclamation. (n.d.). <em>Hydropower program</em>. U.S. Department of the Interior. Retrieved from <a href="https://www.usbr.gov/power/edu/pamphlet.pdf">https://www.usbr.gov/power/edu/pamphlet.pdf</a></li>
</ul>
<p>That quote was taken before zoomers existed so hopefully we have achieved something higher than 90%.</p>
<p>In terms of “sexy and lucrative emerging business ventures”—dams score pretty low. Which makes it ripe for innovation!</p>
<section id="differentiating-types-of-hydroelectric-power-generation" class="level2">
<h2 class="anchored" data-anchor-id="differentiating-types-of-hydroelectric-power-generation">Differentiating types of hydroelectric power generation</h2>
<p>Fossil fuels, renewable, and fusion energy sources all play a role in the nations energy portfolio, but in Idaho—<a href="https://www.notion.so/Energy-0214c4459b524289b881f243c02b890b?pvs=21">around 43% of of the energy generated comes from hydroelectric facilities (5th highest in the nation)!</a></p>
<p>Five of the ten facilities listed in Idaho’s renewable energy breakdown operate as hydroelectric dams.</p>
<p>What might the other forms of hydroelectric generation be?</p>
<p>Let’s break down the most common forms of hydroelectric power generation:</p>
<ul>
<li><strong>Hydroelectric dams:</strong> A large wall built across the width of a river, called a dam, causes a significant reservoir of water to build up. This water can be released at a controlled rate through turbines built into the dam’s structure.
<ul>
<li>Pumped storage facilities can use excess energy to pump water from a lower point to a higher point. This water can then be released through turbines during periods of high energy demand.</li>
</ul></li>
<li><strong>Run-of-the-river hydroelectric plants:</strong> A turbine uses the natural flow of the river without creating a reservoir.</li>
<li><strong>Small-scale hydro projects:</strong> Plants built into existing infrastructure, such as a water supply pipeline, generate electricity without a reservoir.</li>
</ul>
</section>
<section id="hydroelectric-dam-energy-generation-efficiency" class="level2">
<h2 class="anchored" data-anchor-id="hydroelectric-dam-energy-generation-efficiency">Hydroelectric dam energy generation efficiency</h2>
<p>Energy generation facilities maximize the output of energy while minimizing energy loss throughout the system.</p>
<p>Similar to a Costco hotdog going through the human digestive track—undesirable forces tend to ruin good times. For a dam, forces such as turbine friction and water turbulence can cause energy that could have been captured elsewhere to be lost counterproductively.</p>
<p>Take a look at this diagram provided by the <a href="https://www.usgs.gov/media/images/flow-water-produces-hydroelectricity">USGS for a better understanding of the process as a whole.</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./Hydro_Powerplant_Flow.gif" class="img-fluid figure-img"></p>
<figcaption>Fig 1 - hydro power plant diagram from USGS</figcaption>
</figure>
</div>
<ol type="1">
<li>Potential Energy Storage: Water held in the reservoir stores potential energy due to its elevation</li>
<li>Penstock: Water flows down a large pipe called the penstock, converting potential energy to kinetic energy</li>
<li>Turbine: Fast-moving water spins a turbine, creating mechanical energy from the rotating turbine shaft</li>
<li>Generator: The turbine shaft spins, causing a large electromagnet inside the generator to rotate past stationary coils of wire—inducing an electric current through electromagnetic induction (converting mechanical energy to electrical energy)</li>
<li><strong>Dam Transformer</strong>: Lower voltage electricity produced by the generator passes through the high voltage transformer for more efficient long-distance transmission
<ul>
<li>This step doesn’t create new energy but changes the characteristics of the electrical energy (higher voltage, lower current)</li>
</ul></li>
<li><strong>Transmission Lines</strong>: High voltage electricity travels across transmission lines to substations</li>
<li><strong>Substation Transformers</strong>: High voltage electricity passes through the low voltage transformer for distribution to local areas</li>
<li><strong>Distribution Lines</strong>: Lower voltage electricity flows directly to homes and businesses</li>
<li><strong>Local Transformers</strong>: Transformers on power poles or in ground-level boxes further reduce the voltage for use in buildings</li>
<li><strong>Application Usage</strong>: Homes and businesses utilize the energy in various forms (light, heat, mechanical energy in motors, etc.)</li>
</ol>
<p>TLDR spin to win baby!</p>
<section id="public-vs-private-energy-generation" class="level3">
<h3 class="anchored" data-anchor-id="public-vs-private-energy-generation">Public vs private energy generation</h3>
<p>Similar to any other market sector, generation of energy can be a venture owned by private, public, or government corporations. In Idaho it breaks down like this:</p>
<ul>
<li>Private facilities
<ul>
<li>Hells Canyon Complex (a collection of three facilities) = largest privately-owned conventional hydroelectric generating facility in the USA
<ul>
<li>Brownlee Dam</li>
<li>Oxbow Dam</li>
<li>Hells Canyon Dam</li>
</ul></li>
<li>C.J. Strike Dam</li>
<li>Lower Salmon Falls Dam</li>
<li>Cabinet Gorge Dam (only one not owned by Idaho Power, but rather owned by Avista)</li>
<li>Bliss Dam</li>
<li>Upper Salmon Falls Dam</li>
<li>Swan Falls Dam</li>
</ul></li>
<li>Public facilities
<ul>
<li>Dworshak Dam</li>
</ul></li>
<li>State / federal facilities
<ul>
<li>Priest Lake Dam</li>
<li>American Falls Dam</li>
</ul></li>
</ul>
</section>
<section id="somewhat-unrelated-but-interesting-facts-on-powers-biggest-power-users-in-idaho" class="level3">
<h3 class="anchored" data-anchor-id="somewhat-unrelated-but-interesting-facts-on-powers-biggest-power-users-in-idaho">Somewhat unrelated but interesting facts on powers biggest “power users” in Idaho</h3>
<ul>
<li>30% of power goes to industrial usage (it is the gem state after all)</li>
<li>30% of power goes to transportation (Idaho has no petrolium production facilities and has rural transportation capabilities)</li>
<li>24% goes to residential usage</li>
<li>16% goes to commercial usage</li>
</ul>
<p>Idaho consumes 4x more power than it generates (the rest comes from natural gas imports and the Bonneville Power Administration (BPA) which reroutes electric energy from federal dams out-of-state). Surprisingly, Idaho still has the nation’s third-lowest average residential electricity price.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./fig10_1.png" class="img-fluid figure-img"></p>
<figcaption>Fig 2 - not actually Figure 1.10</figcaption>
</figure>
</div>
<ul>
<li><strong>Idaho Office of Energy and Mineral Resources.</strong> (2021). <em>Idaho energy landscape 2021</em>. <a href="https://oemr.idaho.gov/wp-content/uploads/Idaho-Energy-Landscape-2021.pdf">https://oemr.idaho.gov/wp-content/uploads/Idaho-Energy-Landscape-2021.pdf</a></li>
</ul>
<p>As a result of this gap between consumption and production, the Pacific Northwest’s transmission capabilities becomes more congested each year as demands increase across the entire region. Solar and wind energy have the most new projects coming up in the next decade and funding has been funneled towards more.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./total_supply.png" class="img-fluid figure-img"></p>
<figcaption>Fig 3 - in-state energy production vs out-of-state energy import</figcaption>
</figure>
</div>
<ul>
<li><strong>U.S. Energy Information Administration.</strong> (n.d.). <em>Idaho - State electricity profile</em>. U.S. Energy Information Administration. Retrieved August 21, 2024, from <a href="https://www.eia.gov/electricity/state/idaho/index.php">https://www.eia.gov/electricity/state/idaho/index.php</a></li>
</ul>
<p>While annual energy consumption rates in Idaho increase at an annual rate of about 2.5%, energy imports have been decreasing</p>
<p><a href="https://oemr.idaho.gov/financial-information/reports-and-publications/">More reports on Idaho energy can be found here.</a></p>
</section>
</section>
<section id="what-to-read-next" class="level2">
<h2 class="anchored" data-anchor-id="what-to-read-next">What to read next</h2>
<p><a href="../../posts/p3_energy_transmission/index.html">An exploration on transformers</a> and how energy works from a fundamental level!</p>


</section>
</section>

</main> <!-- /main -->
<div>
    <hr>
    
    <h3 class="anchored"> Stay in touch </h3>

    <ul>
        <li>email me at <a href="mailto:ogjaylowe@gmail.com">ogjaylowe@gmail.com</a></li>
        <li>follow and tweet at me on <a href="https://twitter.com/ogjaylowe">Twitter (@ogjaylowe)</a></li>
        <li>follow and DM at me on <a href="https://www.linkedin.com/in/jay-lowe-a21075163/">LinkedIn</a></li>
    </ul>

    <hr>
</div>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ogjaylowe\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>